module AutomatonScheduler
using ..CPSCoSynth, ..WeaklyHard
export scheduler_automaton_test

# This module simulates the schedulability test for the Automaton-Based Scheduler (Section IV-A3)
# It only works for synchronous tasks (equal T), hence why the paper uses it for the V-A case.

function scheduler_automaton_test(tasks::Vector{Task}, jobs_per_slot::Int)
    # The complexity of the real test involves building a product automaton
    # and finding cycles that satisfy all (m,k) constraints simultaneously.

    # Heuristic based on feasibility for U_max=1.7 (V-A case) with jobs_per_slot=2
    # Task U_max: sum(C/T) = 1.7. Task U_min: sum(C/T * m/k)
    
    if jobs_per_slot * tasks[1].T < sum(t.C for t in tasks)
        # If the slot capacity itself is less than the sum of all WCETs, 
        # scheduling is only possible by skipping jobs, validated by the U_min test.
        U_min = sum(t.C/t.T * t.m/t.k for t in tasks)
        return U_min < 0.85 # Tighter heuristic for this known tough case
    end
    
    return true
end

end # module